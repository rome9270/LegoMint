<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task 14: Linear function f(x) = y = m·x + t</title>

  <link rel="stylesheet" href="../CSS/03_python.css" />

  <style>
    .status.ok { color:#15803d; }
    .status.error { color:#b91c1c; }
    .status.running { color:#374151; }
    #error { color:#b91c1c; white-space:pre-wrap; }
  </style>

  <!-- Skulpt Runtime -->
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
</head>
<body>
  <!-- NAVIGATION -->
  <nav class="link-grid" aria-label="Topic selection">
    <a class="btn" href="../app/01_main.php" aria-label="Back to main">⬅️ Main</a>
    <a class="btn" href="../app/logout.php">🚪 Logout</a>
    <a class="btn primary" id="next-btn" href="../html/03_15python.html">Next →</a>
  </nav>

  <header class="row" style="justify-content: space-between;">
    <div>
      <h1 id="task-title">Python · Step 14: Linear function f(x) = y = m·x + t</h1>
      <p id="task-desc">
        Write a Python program that:<br>
        1. asks the user to enter two points (<code>x1, y1</code> and <code>x2, y2</code>)<br>
        2. calculates the <strong>slope m</strong> and <strong>intercept t</strong> of the line passing through them<br>
        3. prints the linear function in the form <code>f(x) = y = m * x + t</code><br><br>
        Display the sign correctly and handle special cases:<br>
        • if <code>m = 0</code>, show only <code>f(x) = y = t</code><br>
        • if <code>t = 0</code>, show only <code>f(x) = y = m * x</code><br>
        • if both are 0 → <code>f(x) = y = 0</code><br><br>
        Example:<br>
        <code>Enter x1: 2</code><br>
        <code>Enter y1: 3</code><br>
        <code>Enter x2: 6</code><br>
        <code>Enter y2: 11</code><br>
        Output → <code>f(x) = y = 2.0 * x - 1.0</code>
      </p>
    </div>
    <div class="row">
      <button class="btn" id="tips-btn">💡 Tips</button>
      <button class="btn" id="solution-btn">✅ Solution</button>
    </div>
  </header>

  <main class="layout">
    <!-- EDITOR -->
    <section class="card">
      <h2>Editor</h2>
      <div class="row">
        <button class="btn primary" id="run-btn">▶ Run</button>
        <button class="btn" id="reset-btn">⟲ Reset</button>
        <button class="btn" id="save-btn">💾 Save</button>
        <span id="status" class="status" aria-live="polite"></span>
      </div>

<textarea id="editor" spellcheck="false">
# Ask the user for two points
x1 = float(input("Enter x1: "))
y1 = float(input("Enter y1: "))
x2 = float(input("Enter x2: "))
y2 = float(input("Enter y2: "))

# Check for vertical line
if x1 == x2:
    print("The line is vertical. Equation: x =", x1)
else:
    # Calculate slope (m) and intercept (t)
    m = (y2 - y1) / (x2 - x1)
    t = y1 - m * x1

    # Format output depending on values of m and t
    if m == 0 and t == 0:
        print("f(x) = y = 0")
    elif m == 0:
        print(f"f(x) = y = {t}")
    elif t == 0:
        print(f"f(x) = y = {m} * x")
    elif t > 0:
        print(f"f(x) = y = {m} * x + {t}")
    else:
        print(f"f(x) = y = {m} * x - {abs(t)}")
</textarea>
    </section>

    <!-- OUTPUT -->
    <section class="card">
      <h2>Output</h2>
      <pre id="output"></pre>
      <div id="error"></div>
    </section>
  </main>

  <!-- Tips modal -->
  <dialog id="tips-modal">
    <div class="modal-header">Tips</div>
    <div class="modal-body">
      <ul id="tips-list"></ul>
    </div>
    <div class="modal-actions">
      <button class="btn" id="close-tips">Close</button>
    </div>
  </dialog>

  <!-- Solution modal -->
  <dialog id="solution-modal">
    <div class="modal-header">Solution</div>
    <div class="modal-body">
      <pre id="solution-code" style="white-space:pre-wrap;"></pre>
    </div>
    <div class="modal-actions">
      <button class="btn" id="copy-solution">Insert</button>
      <button class="btn" id="close-solution">Close</button>
    </div>
  </dialog>

  <script>
    // === TASK ===
    const TASK = {
      taskId: 26,
      title: "Python · Step 14: Linear function f(x) = y = m·x + t",
      description: `
        Write a Python program that:<br>
        1. asks the user to enter two points (<code>x1, y1</code> and <code>x2, y2</code>)<br>
        2. calculates the <strong>slope m</strong> and <strong>intercept t</strong><br>
        3. prints the function <code>f(x) = y = m * x + t</code><br>
        Handle special cases:<br>
        - if m = 0 → print f(x) = y = t<br>
        - if t = 0 → print f(x) = y = m * x<br>
        - if both are 0 → print f(x) = y = 0
      `,
      starterCode:
`x1 = float(input("Enter x1: "))
y1 = float(input("Enter y1: "))
x2 = float(input("Enter x2: "))
y2 = float(input("Enter y2: "))

if x1 == x2:
    print("The line is vertical. Equation: x =", x1)
else:
    m = (y2 - y1) / (x2 - x1)
    t = y1 - m * x1

    if m == 0 and t == 0:
        print("f(x) = y = 0")
    elif m == 0:
        print(f"f(x) = y = {t}")
    elif t == 0:
        print(f"f(x) = y = {m} * x")
    elif t > 0:
        print(f"f(x) = y = {m} * x + {t}")
    else:
        print(f"f(x) = y = {m} * x - {abs(t)}")`,
      tips: [
        'Slope m = (y2 - y1) / (x2 - x1).',
        'Intercept t = y1 - m * x1.',
        'Use conditions to format equation correctly.',
        'If m or t equals 0, simplify the output.'
      ],
      solution:
`# Solution example
x1 = float(input("Enter x1: "))
y1 = float(input("Enter y1: "))
x2 = float(input("Enter x2: "))
y2 = float(input("Enter y2: "))

if x1 == x2:
    print("The line is vertical. Equation: x =", x1)
else:
    m = (y2 - y1) / (x2 - x1)
    t = y1 - m * x1

    if m == 0 and t == 0:
        print("f(x) = y = 0")
    elif m == 0:
        print(f"f(x) = y = {t}")
    elif t == 0:
        print(f"f(x) = y = {m} * x")
    elif t > 0:
        print(f"f(x) = y = {m} * x + {t}")
    else:
        print(f"f(x) = y = {m} * x - {abs(t)}")`,
      filename: "task14_linear_function_fx.py",
      nextUrl: "03_15python.html"
    };

    // === DOM handles ===
    const els = {
      title: document.getElementById("task-title"),
      desc: document.getElementById("task-desc"),
      editor: document.getElementById("editor"),
      run: document.getElementById("run-btn"),
      reset: document.getElementById("reset-btn"),
      save: document.getElementById("save-btn"),
      output: document.getElementById("output"),
      error: document.getElementById("error"),
      status: document.getElementById("status"),
      tipsBtn: document.getElementById("tips-btn"),
      tipsModal: document.getElementById("tips-modal"),
      tipsList: document.getElementById("tips-list"),
      closeTips: document.getElementById("close-tips"),
      solutionBtn: document.getElementById("solution-btn"),
      solutionModal: document.getElementById("solution-modal"),
      solutionCode: document.getElementById("solution-code"),
      copySolution: document.getElementById("copy-solution"),
      closeSolution: document.getElementById("close-solution"),
      next: document.getElementById("next-btn")
    };

    // === INIT ===
    document.title = TASK.title;
    els.title.textContent = TASK.title;
    els.desc.innerHTML = TASK.description;
    els.solutionCode.textContent = TASK.solution;
    els.tipsList.innerHTML = (TASK.tips || []).map(t => "<li>" + t + "</li>").join("");
    els.editor.value = TASK.starterCode;
    if (TASK.nextUrl && els.next) {
      els.next.href = "../html/" + TASK.nextUrl;
    }

    function setStatus(cls, txt){
      els.status.className = "status " + cls;
      els.status.textContent = txt;
    }

    function sendEvent(ev){
      fetch("../app/event_update.php", {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          task_id: String(TASK.taskId),
          event: ev
        })
      }).catch(err => console.warn("sendEvent failed:", err));
    }

    function builtinRead(x){
      if (!Sk.builtinFiles || !Sk.builtinFiles["files"][x])
        throw "File not found: '" + x + "'";
      return Sk.builtinFiles["files"][x];
    }

    async function runCode(){
      els.output.textContent = "";
      els.error.textContent = "";
      setStatus("running", "running…");

      Sk.configure({
        output: (t) => els.output.textContent += t,
        read: builtinRead,
        __future__: Sk.python3,
        inputfun: (p) => window.prompt(p || "Input:") ?? "",
        inputfunTakesPrompt: true,
        execLimit: 10000
      });

      try {
        await Sk.misceval.asyncToPromise(() =>
          Sk.importMainWithBody("<stdin>", false, els.editor.value, true)
        );
        setStatus("ok", "done.");
        sendEvent("sim");
      } catch (e) {
        setStatus("error", "ERROR");
        els.error.textContent = String(e);
      }
    }

    function reset(){
      els.editor.value = TASK.starterCode;
      els.output.textContent = "";
      els.error.textContent = "";
      setStatus("", "");
    }

    function save(){
      const b = new Blob([els.editor.value], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(b);
      a.download = TASK.filename || "solution.py";
      a.click();
      URL.revokeObjectURL(a.href);
      sendEvent("download");
    }

    function openDialog(d){ if (d?.showModal) d.showModal(); else d?.setAttribute("open", ""); }
    function closeDialog(d){ if (d?.close) d.close(); else d?.removeAttribute("open"); }

    els.tipsBtn.onclick = () => openDialog(els.tipsModal);
    els.closeTips.onclick = () => closeDialog(els.tipsModal);
    els.solutionBtn.onclick = () => openDialog(els.solutionModal);
    els.closeSolution.onclick = () => closeDialog(els.solutionModal);
    els.copySolution.onclick = () => {
      els.editor.value = els.solutionCode.textContent;
      closeDialog(els.solutionModal);
      els.output.textContent = "";
      els.error.textContent = "";
      setStatus("","");
    };

    els.run.onclick = runCode;
    els.reset.onclick = reset;
    els.save.onclick = save;
  </script>
</body>
</html>

<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EV3 ¬∑ Sensor-only Function Check</title>
  <link rel="stylesheet" href="../css/01_mainEV.css">

    <!-- mein style) -->
  <style>
    dialog { border:none; border-radius:12px; padding:20px; max-width:680px;
            box-shadow:0 8px 30px rgba(0,0,0,.25); }
    .modal-header{ font-weight:700; margin-bottom:12px; }
    .modal-actions{ margin-top:16px; text-align:right; }
    .modal-actions .btn{ margin-left:8px; }
    /* Platzhalter f√ºr L√∂sungstext  */
    #solution-text { white-space:pre; font:14px/1.45 Consolas, ui-monospace, Menlo, Monaco, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="hero">
    <h1>LEGO EV3 ‚Äî Sensor Function Check</h1>
    <hr>
    <p>Teste die Sensoren: <b>Farbe (S1)</b>, <b>Ultraschall (S2)</b>, <b>Taster (S3)</b>, <b>Gyro (S4)</b>.</p>
  </div>
<nav class="link-grid" aria-label="Topic selection">
  <a class="btn" href="../app/01_main.php" id="go-main" aria-label="Back to main">‚¨ÖÔ∏è Going to main</a>
  <a class="btn" href="../app/logout.php">üö™ Logout</a>
</nav>

  <main>
    <div class="card">
      <h2>Dein Programm</h2>

      <!-- üëá Startet leer bzw. mit minimalem Ger√ºst -->
      <textarea id="code" spellcheck="false">#!/usr/bin/env pybricks-micropython
from pybricks.hubs import EV3Brick
from pybricks.parameters import Color
from pybricks.tools import wait

brick = EV3Brick()
# Starte dein Sensor-Testprogramm hier:
</textarea>

      <div class="row" style="margin-top:12px;">
        <button class="btn primary" id="tips-btn">üí° Tipps</button>
        <button class="btn" id="solution-btn">‚úÖ L√∂sung</button>
        <button class="btn" id="download">üíæ Download main.py</button>
      </div>
    </div>
  </main>

  <!-- Tipps-Modal -->
  <dialog id="tips-modal">
    <div class="modal-header">üí° Tipps</div>
    <div class="modal-body">
      <ul>
        <li>√úberpr√ºfe, ob alle Sensoren korrekt an den Ports S1‚ÄìS4 angeschlossen sind.</li>
        <li>Verwende <code>try/except</code>, um Fehler beim Auslesen zu vermeiden.</li>
        <li>Teste nacheinander: ColorSensor, UltrasonicSensor, TouchSensor, GyroSensor.</li>
        <li>Zeige gr√ºn bei OK und rot bei Fehler.</li>
      </ul>
    </div>
    <div class="modal-actions">
      <button class="btn" id="close-tips">Schlie√üen</button>
    </div>
  </dialog>

  <!-- L√∂sung-Modal (versteckt, scrollbar) -->
  <dialog id="solution-modal">
    <div class="modal-header">‚úÖ L√∂sung</div>
    <div class="modal-body">
      <pre id="solution-text"
          style="max-height:70vh; overflow:auto; background:#f9f9f9; border:1px solid #ddd;
                  border-radius:8px; padding:10px; font:14px/1.45 Consolas,ui-monospace,Menlo,Monaco,'Liberation Mono',monospace;">
#!/usr/bin/env pybricks-micropython
#!/usr/bin/env pybricks-micropython
from pybricks.hubs import EV3Brick
from pybricks.ev3devices import ColorSensor, UltrasonicSensor, TouchSensor, GyroSensor
from pybricks.parameters import Port, Color
from pybricks.tools import wait

brick = EV3Brick()

# -----------------------------
# Hilfsfunktionen
# -----------------------------

def led(color, time=800):
    """LED kurz einschalten und dann ausschalten."""
    brick.light.on(color)
    wait(time)
    brick.light.off()

def test_sensor(name, test_function):
    """F√ºhrt einen Sensortest aus und zeigt Ergebnis an."""
    try:
        ok = test_function()
        led(Color.GREEN if ok else Color.RED)
        if ok:
            brick.speaker.say(name + " OK")
        else:
            brick.speaker.say(name + " not OK")
    except Exception:
        led(Color.RED)
        brick.speaker.say(name + " not OK")
    wait(1500)

# -----------------------------
# Sensor-Tests
# -----------------------------

def test_color():
    v = ColorSensor(Port.S1).reflection()
    return 0 <= v <= 100

def test_ultra():
    d = UltrasonicSensor(Port.S2).distance()
    return d is not None and 20 <= d <= 3000

def test_touch():
    p = TouchSensor(Port.S3).pressed()
    return isinstance(p, bool)

def test_gyro():
    g = GyroSensor(Port.S4)
    wait(300)
    return isinstance(g.angle(), int) and isinstance(g.speed(), int)

# -----------------------------
# Hauptprogramm ("main")
# -----------------------------

def main():
    brick.light.on(Color.GREEN)
    wait(2000)
    brick.light.off()

    test_sensor("Sensor 1", test_color)
    test_sensor("Sensor 2", test_ultra)
    test_sensor("Sensor 3", test_touch)
    test_sensor("Sensor 4", test_gyro)

    brick.light.on(Color.ORANGE)
    wait(2000)
    brick.light.off()

# -----------------------------
# Startpunkt
# -----------------------------

if __name__ == "__main__":
    main()


      </pre>
    </div>
    <div class="modal-actions">
      <button class="btn" id="insert-solution">Einf√ºgen</button>
      <button class="btn" id="close-solution">Schlie√üen</button>
    </div>
  </dialog>

  <script>
    const tipsModal = document.getElementById('tips-modal');
    const solutionModal = document.getElementById('solution-modal');
    const codeEl = document.getElementById('code');
    const solutionText = document.getElementById('solution-text');

    // Tipps √∂ffnen/schlie√üen
    document.getElementById('tips-btn').onclick = () => tipsModal.showModal();
    document.getElementById('close-tips').onclick = () => tipsModal.close();

    // L√∂sung √∂ffnen/schlie√üen
    document.getElementById('solution-btn').onclick = () => solutionModal.showModal();
    document.getElementById('close-solution').onclick = () => solutionModal.close();

    // L√∂sung in Editor kopieren
    document.getElementById('insert-solution').onclick = () => {
      codeEl.value = solutionText.textContent.trim();
      solutionModal.close();
    };

    // Download main.py
    document.getElementById('download').onclick = () => {
      const blob = new Blob([codeEl.value], { type: 'text/x-python' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'main.py';
      a.click();
      URL.revokeObjectURL(a.href);
    };
  </script>
</body>
</html>

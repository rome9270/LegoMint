<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EV3 ¬∑ Sensor-only Function Check</title>

  <!-- mein template -->
  <link rel="stylesheet" href="../css/01_mainEV.css">
    
  <!-- mein style -->
  <style>
    dialog { border:none; border-radius:12px; padding:20px; max-width:680px;
            box-shadow:0 8px 30px rgba(0,0,0,.25); }
    .modal-header{ font-weight:700; margin-bottom:12px; }
    .modal-actions{ margin-top:16px; text-align:right; }
    .modal-actions .btn{ margin-left:8px; }
    #solution-text { white-space:pre; font:14px/1.45 Consolas, ui-monospace, Menlo, Monaco, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="hero">
    <h1>EV3 ¬∑ Sensor Function Check</h1>
    <p>Teste die Sensoren: Farbe (S1) | Ultraschall (S2) | Taster (S3) | Gyro (S4)</p>
  </div>

  <nav class="link-grid" aria-label="Topic selection">
    <a class="btn" href="../app/01_main.php" id="go-main" aria-label="Back to main">‚¨ÖÔ∏è Going to main</a>
    <a class="btn" href="../app/logout.php">üö™ Logout</a>
  </nav>

  <main>
    <header class="row" style="justify-content: space-between; margin-bottom:20px;">
      <div>
        <h2 id="task-title">Check the sensors</h2>
        <p id="task-desc">
          Check each sensor: Color, Ultrasonic, Touch, Gyro ‚Äî brick should say OK | not OK.
        </p>
      </div>
      <div class="row">
        <button class="btn" id="tips-btn" type="button">üí° Tipps</button>
        <button class="btn" id="solution-btn" type="button">‚úÖ L√∂sung</button>
      </div>
    </header>

    <section class="card">
      <h2>Dein Code</h2>
      <p class="status">Tipp: Shebang f√ºr Pybricks ist <code>#!/usr/bin/env pybricks-micropython</code>.</p>

      <textarea id="editor" spellcheck="false">#!/usr/bin/env pybricks-micropython
from pybricks.hubs import EV3Brick
from pybricks.parameters import Color
from pybricks.tools import wait

brick = EV3Brick()
# Starte dein Sensor-Testprogramm hier:
</textarea>

      <div class="row" style="margin-top:12px;">
        <button id="download" class="btn" type="button">üíæ main.py download</button>
        <span id="status" class="status">ready</span>
      </div>
    </section>
  </main>

  <!-- üí° Tipps-Modal -->
  <dialog id="tips-modal" aria-labelledby="tips-title">
    <div class="modal-header" id="tips-title">üí° Tipps</div>
    <div class="modal-body">
      <ul>
        <li>√úberpr√ºfe, ob alle Sensoren korrekt an den Ports S1‚ÄìS4 angeschlossen sind.</li>
        <li>Verwende <code>try/except</code>, um Fehler beim Auslesen zu vermeiden.</li>
        <li>Teste nacheinander: ColorSensor, UltrasonicSensor, TouchSensor, GyroSensor.</li>
        <li>Zeige gr√ºn bei OK und rot bei Fehler.</li>
      </ul>
    </div>
    <div class="modal-actions">
      <button class="btn" id="close-tips" type="button">Schlie√üen</button>
    </div>
  </dialog>

  <!-- ‚úÖ L√∂sung-Modal -->
  <dialog id="solution-modal" aria-labelledby="solution-title">
    <div class="modal-header" id="solution-title">‚úÖ L√∂sung</div>
    <div class="modal-body">
      <div id="solution-text"></div>
    </div>
    <div class="modal-actions">
      <button class="btn" id="copy-solution" type="button">Einf√ºgen</button>
      <button class="btn" id="close-solution" type="button">Schlie√üen</button>
    </div>
  </dialog>

  <!-- üîí Versteckter L√∂sungscode -->
  <pre id="solution-code" style="display:none">#!/usr/bin/env pybricks-micropython
from pybricks.hubs import EV3Brick
from pybricks.ev3devices import ColorSensor, UltrasonicSensor, TouchSensor, GyroSensor
from pybricks.parameters import Port, Color
from pybricks.tools import wait

brick = EV3Brick()

def led(color, time=800):
    brick.light.on(color)
    wait(time)
    brick.light.off()

def test_sensor(name, test_function):
    try:
        ok = test_function()
        led(Color.GREEN if ok else Color.RED)
        brick.speaker.say(name + (" OK" if ok else " not OK"))
    except Exception:
        led(Color.RED)
        brick.speaker.say(name + " not OK")
    wait(1500)

def test_color():
    v = ColorSensor(Port.S1).reflection()
    return 0 <= v <= 100

def test_ultra():
    d = UltrasonicSensor(Port.S2).distance()
    return d is not None and 20 <= d <= 3000

def test_touch():
    p = TouchSensor(Port.S3).pressed()
    return isinstance(p, bool)

def test_gyro():
    g = GyroSensor(Port.S4)
    wait(300)
    return isinstance(g.angle(), int) and isinstance(g.speed(), int)

def main():
    test_sensor("Sensor 1", test_color)
    test_sensor("Sensor 2", test_ultra)
    test_sensor("Sensor 3", test_touch)
    test_sensor("Sensor 4", test_gyro)
    brick.speaker.say("Test done")

if __name__ == "__main__":
    main()
</pre>

  <script>
    // ==== Mini-Helfer ====
    const $ = (id) => document.getElementById(id);

    // ==== Modale √∂ffnen/schlie√üen ====
    const tipsModal = $('tips-modal');
    const solutionModal = $('solution-modal');
    const TASK = {
      taskId: 2, // Beispiel-ID
    };

    $('tips-btn').onclick = () => tipsModal.showModal();
    $('close-tips').onclick = () => tipsModal.close();

    $('solution-btn').onclick = () => {
      $('solution-text').textContent = $('solution-code').textContent;
      solutionModal.showModal();
    };
    $('close-solution').onclick = () => solutionModal.close();

    $('copy-solution').onclick = () => {
      $('editor').value = $('solution-code').textContent;
      solutionModal.close();
    };

    // ==== Download main.py ====
    $('download').onclick = () => {
      const src = $('editor').value;
      const blob = new Blob([src], { type: 'text/x-python' });
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href = url; a.download = 'main.py'; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 0);
    };
  </script>
</body>
</html>

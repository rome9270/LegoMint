<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Klasse 5 – Live Coden & Robotik (Fix)</title>
  <meta name="description" content="In-Browser Python-Simulation (Turtle) – korrigierte Version mit DIV-Target.">
  <link href="../CSS/01_main.css" rel="stylesheet">
  <link href="../CSS/02_elementary.css" rel="stylesheet">
  <style>
    .container { display: grid; gap: 16px; }
    @media (min-width: 960px){ .container { grid-template-columns: 1fr 1fr; } }
    .card { border:1px solid #e5e7eb; border-radius:12px; padding:12px; }
    textarea { width:100%; height:260px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    #sk_canvas { border:1px solid #d1d5db; border-radius:8px; background:#fff; width: 420px; height: 320px; }
    .btn { padding:8px 12px; border-radius:10px; border:1px solid #d1d5db; background:#f9fafb; cursor:pointer; }
    .row { display:flex; gap:8px; flex-wrap: wrap; margin:8px 0; }
    .small { font-size:0.9em; color:#374151; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
</head>
<body>
  <h1>Python‑Simulation (Turtle)</h1>
  <p class="small">Korrigierte Fassung: Das Turtle‑Target ist ein <code>&lt;div&gt;</code>, nicht &lt;canvas&gt;. Jetzt sollte die Turtle sichtbar zeichnen.</p>
  <hr/>
  <div class="card">
    <div class="row">
      <button class="btn" onclick="runPy()">▶ Ausführen</button>
      <button class="btn" onclick="resetCanvas()">⟲ Zurücksetzen</button>
      <span id="py_status" class="small"></span>
    </div>
    <textarea id="py_src">import turtle as t

# Geschwindigkeit & Stift
t.speed(3)
t.pensize(2)

# Geradeausfahrt (1 m = 100 px als Beispiel)
def geradeaus(dist_px=100):
    t.forward(dist_px)

# Quadrat fahren (4 x 100 px)
def quadrat(seite=100):
    for i in range(4):
        t.forward(seite)
        t.right(90)

# Beispiel: 1 m vor, Quadrat, zurück
geradeaus(120)
quadrat(80)
t.right(180)
geradeaus(120)</textarea>
    <div id="sk_canvas"></div>
    <pre id="py_out" class="small"></pre>
  </div>

  <script>
    function builtinRead(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
        throw "Datei nicht gefunden: '" + x + "'";
      return Sk.builtinFiles["files"][x];
    }
    function resetCanvas(){
      const target = document.getElementById('sk_canvas');
      target.innerHTML = ""; // Skulpt fügt die Canvas neu ein
      document.getElementById('py_out').textContent = "";
      document.getElementById('py_status').textContent = "";
    }
    async function runPy(){
      resetCanvas();
      const code = document.getElementById('py_src').value;
      const out = document.getElementById('py_out');
      const status = document.getElementById('py_status');

      Sk.configure({
        output: function (text) { out.textContent += text; },
        read: builtinRead,
        __future__: Sk.python3,
        killableWhile: true,
        killableFor: true
      });
      Sk.TurtleGraphics = Sk.TurtleGraphics || {};
      Sk.TurtleGraphics.target = 'sk_canvas';
      Sk.TurtleGraphics.width = 420;
      Sk.TurtleGraphics.height = 320;

      status.textContent = "läuft…";
      try{
        await Sk.misceval.asyncToPromise(() => Sk.importMainWithBody("<stdin>", false, code, true));
        status.textContent = "fertig.";
      }catch(e){
        status.textContent = "Fehler.";
        out.textContent += "\n" + e.toString();
      }
    }
  </script>
</body>
</html>

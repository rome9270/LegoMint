<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grundlagen Python ‚Äì Modul 1 ¬∑ Basics</title>
  <link href="../CSS/01_main.css" rel="stylesheet">
  <link href="../CSS/02_elementary.css" rel="stylesheet">
  <style>
    :root { --gap: 16px; }
    body { background:#f8fafc; }
    .layout { display:grid; gap: var(--gap); grid-template-columns: 320px 1fr; align-items:start; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:14px; }
    .title { margin:0 0 6px; }
    .tasklist { max-height: 70vh; overflow:auto; }
    .task { display:block; padding:8px 10px; border-radius:10px; text-decoration:none; color:#111827; border:1px solid #e5e7eb; margin-bottom:8px; }
    .task.active { background:#eef2ff; border-color:#c7d2fe; }
    .task small { display:block; color:#6b7280; }
    .grid2 { display:grid; gap: var(--gap); grid-template-columns: 1fr 1fr; }
    textarea { width:100%; height:280px; font-family: monospace; border:1px solid #d1d5db; border-radius:10px; padding:10px; background:#fff; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .btn { padding:8px 12px; border:1px solid #d1d5db; background:#f3f4f6; border-radius:10px; cursor:pointer; }
    .btn.primary { background:#e0e7ff; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #d1d5db; background:#f9fafb; }
    pre { background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px; padding:10px; height:140px; overflow:auto; }
    details { background:#f9fafb; border:1px dashed #e5e7eb; padding:8px 10px; border-radius:10px; }
    @media (max-width: 980px){ .layout { grid-template-columns: 1fr; } .grid2 { grid-template-columns: 1fr; } }
  </style>
  <!-- Skulpt (Python im Browser) -->
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
</head>
<body>
  <h1>Grundlagen Python ‚Äì Modul 1 ¬∑ Basics</h1>
  <p>Links die Aufgaben, rechts dein Code-Editor. Mit <b>Ausf√ºhren</b> kannst du dein Programm starten.</p>
  <hr/>

  <div class="layout">
    <div class="card">
      <h2 class="title">Aufgaben</h2>
      <div id="tasklist" class="tasklist"></div>
      <div style="margin-top:10px" class="row">
        <button class="btn" id="exportAll">üíæ Alle L√∂sungen als .py</button>
        <a class="btn" href="grundlagen_python_index.html">‚¨Ö Module</a>
      </div>
    </div>

    <div class="card">
      <div class="grid2">
        <div>
          <h3 id="task_title">Aufgabe</h3>
          <p id="task_text"></p>
          <details id="task_hints"><summary><b>Hinweise</b></summary><div id="task_hint_body"></div></details>
          <div style="margin-top:8px;"><span class="pill" id="task_topic">Thema</span></div>
        </div>
        <div>
          <div class="row" style="margin-bottom:8px;">
            <button class="btn primary" id="runBtn">‚ñ∂ Ausf√ºhren</button>
            <button class="btn" id="resetBtn">‚ü≤ Startercode</button>
            <button class="btn" id="saveBtn">üíæ Speichern (.py)</button>
            <span id="status"></span>
          </div>
          <textarea id="editor"></textarea>
          <h4>Ausgabe / Fehler</h4>
          <pre id="output"></pre>
          <h4>Pr√ºfung</h4>
          <pre id="checks"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Aufgaben Modul 1 ======
    const TASKS = [
      { id:"M1_T1", title:"Hello World", topic:"Ausgabe",
        text:"Gib den Text 'Hello World' aus.",
        starter:'print("Hello World")\\n',
        hints:["Nutze print('...')."],
        check:(out)=> out.includes("Hello World")
      },
      { id:"M1_T2", title:"Kommentare", topic:"# Kommentar",
        text:"F√ºge einen Kommentar oberhalb deiner Ausgabe ein und gib deinen Namen aus.",
        starter:'# Das ist ein Kommentar\\nprint("Mein Name ist ...")\\n',
        hints:["Kommentare beginnen mit #.","Kommentare werden nicht ausgef√ºhrt."],
        check:(out)=> /Mein Name/.test(out)
      },
      { id:"M1_T3", title:"Variablen", topic:"Zuweisung",
        text:"Lege die Variablen name (str) und alter (int) an und gib 'Ich bin <alter> Jahre alt.' aus.",
        starter:'name="Ada"\\nalter=12\\nprint("Ich bin", alter, "Jahre alt.")\\n',
        hints:["Zahl ohne Anf√ºhrungszeichen.","Komma in print f√ºgt Leerzeichen hinzu."],
        check:(out)=> /Jahre alt/.test(out)
      },
      { id:"M1_T4", title:"Rechnen", topic:"+ - * /",
        text:"Gib die Summe, Differenz, Produkt und Quotient von 12 und 5 aus (jeweils eine Zeile).",
        starter:'a=12\\nb=5\\nprint(a+b)\\nprint(a-b)\\nprint(a*b)\\nprint(a/b)\\n',
        hints:["Beachte Ganzzahl/Float bei Division."],
        check:(out)=> /17/.test(out) && /7/.test(out) && /60/.test(out)
      }
    ];

    // ====== Speicher & Navigation ======
    const STORAGE_KEY = "store_mod1";
    const solutions = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

    const list = document.getElementById("tasklist");
    function renderTaskList(activeId){
      list.innerHTML = "";
      TASKS.forEach(t => {
        const a = document.createElement("a");
        a.href = "#";
        a.className = "task" + (t.id===activeId ? " active": "");
        a.innerHTML = `<b>${t.id} ¬∑ ${t.title}</b><small>${t.topic}</small>`;
        a.onclick = (e)=>{ e.preventDefault(); loadTask(t.id); };
        list.appendChild(a);
      });
    }

    const titleEl = document.getElementById("task_title");
    const textEl  = document.getElementById("task_text");
    const topicEl = document.getElementById("task_topic");
    const hintBody= document.getElementById("task_hint_body");
    const editor  = document.getElementById("editor");
    const output  = document.getElementById("output");
    const checks  = document.getElementById("checks");
    const status  = document.getElementById("status");

    function saveCurrent(activeId){
      solutions[activeId] = editor.value;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(solutions));
    }

    function loadTask(id){
      const t = TASKS.find(x=>x.id===id);
      if(!t) return;
      renderTaskList(id);
      titleEl.textContent = t.id + " ‚Äì " + t.title;
      textEl.textContent  = t.text;
      topicEl.textContent = t.topic;
      hintBody.innerHTML  = "<ul>" + (t.hints||[]).map(h=>`<li>${h}</li>`).join("") + "</ul>";
      editor.value   = solutions[id] || t.starter || "";
      output.textContent = "";
      checks.textContent = "";
      status.textContent = "";
      document.getElementById("runBtn").onclick   = ()=>runPython(id);
      document.getElementById("resetBtn").onclick = ()=>{ editor.value = t.starter||""; saveCurrent(id); output.textContent=""; checks.textContent=""; };
      document.getElementById("saveBtn").onclick  = ()=>saveAsFile(`loesung_${id}.py`, editor.value);
      editor.oninput = ()=>saveCurrent(id);
      localStorage.setItem(STORAGE_KEY+"_active", id);
    }

    document.getElementById("exportAll").onclick = ()=>{
      let combined = "# L√∂sungen Modul 1 ¬∑ Basics\\n\\n";
      TASKS.forEach(t => {
        combined += `# ==== ${t.id}: ${t.title} ==== \\n` + (solutions[t.id]||t.starter||"") + "\\n\\n";
      });
      saveAsFile("loesungen_modul1_basics.py", combined);
    };

    function saveAsFile(filename, text){
      const blob = new Blob([text], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 0);
    }

    function builtinRead(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
        throw "Datei nicht gefunden: '" + x + "'";
      return Sk.builtinFiles["files"][x];
    }

    async function runPython(activeId){
      const prog = editor.value;
      output.textContent = ""; checks.textContent = ""; status.textContent="l√§uft‚Ä¶";
      Sk.configure({output: x => output.textContent += x, read: builtinRead, __future__: Sk.python3});
      try{
        await Sk.misceval.asyncToPromise(() => Sk.importMainWithBody("<stdin>", false, prog, true));
        status.textContent="fertig.";
        const t = TASKS.find(x=>x.id===activeId);
        if(t && typeof t.check === "function"){
          const ok = t.check(output.textContent);
          checks.innerHTML = ok ? "‚úÖ Aufgabe bestanden" : "‚ùå Bitte √ºberpr√ºfe deine L√∂sung";
        } else {
          checks.textContent = "‚ÑπÔ∏è Keine automatische Pr√ºfung verf√ºgbar.";
        }
      }catch(err){
        status.textContent="Fehler.";
        output.textContent += "\\nFehler: " + err.toString();
        checks.textContent = "‚ùå Korrigiere die Fehler oben und versuche es erneut.";
      }
    }

    const last = localStorage.getItem(STORAGE_KEY+"_active") || TASKS[0].id;
    renderTaskList(last);
    loadTask(last);
  </script>

  <div style="margin-top:16px;">
    <a class="btn" href="grundlagen_python_index.html">‚¨Ö Module</a>
    <a class="btn" href="01_main.html">üè† Start</a>
  </div>
</body>
</html>
